!function(){var e=setTimeout;function n(){}function t(e){if(!(this instanceof t))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],u(e,this)}function o(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,t._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var o;try{o=t(e._value)}catch(e){return void i(n.promise,e)}r(n.promise,o)}else(1===e._state?r:i)(n.promise,e._value)})):e._deferreds.push(n)}function r(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var o=n.then;if(n instanceof t)return e._state=3,e._value=n,void a(e);if("function"==typeof o)return void u((r=o,c=n,function(){r.apply(c,arguments)}),e)}e._state=1,e._value=n,a(e)}catch(n){i(e,n)}var r,c}function i(e,n){e._state=2,e._value=n,a(e)}function a(e){2===e._state&&0===e._deferreds.length&&t._immediateFn(function(){e._handled||t._unhandledRejectionFn(e._value)});for(var n=0,r=e._deferreds.length;n<r;n++)o(e,e._deferreds[n]);e._deferreds=null}function c(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}function u(e,n){var t=!1;try{e(function(e){t||(t=!0,r(n,e))},function(e){t||(t=!0,i(n,e))})}catch(e){if(t)return;t=!0,i(n,e)}}t.prototype.catch=function(e){return this.then(null,e)},t.prototype.then=function(e,t){var r=new this.constructor(n);return o(this,new c(e,t,r)),r},t.prototype.finally=function(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})},t.all=function(e){return new t(function(n,t){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var o=Array.prototype.slice.call(e);if(0===o.length)return n([]);var r=o.length;function i(e,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void c.call(a,function(n){i(e,n)},t)}o[e]=a,0==--r&&n(o)}catch(e){t(e)}}for(var a=0;a<o.length;a++)i(a,o[a])})},t.resolve=function(e){return e&&"object"==typeof e&&e.constructor===t?e:new t(function(n){n(e)})},t.reject=function(e){return new t(function(n,t){t(e)})},t.race=function(e){return new t(function(n,t){for(var o=0,r=e.length;o<r;o++)e[o].then(n,t)})},t._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(n){e(n,0)},t._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var s=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();s.Promise||(s.Promise=t);var l="stats",f=function(e){return e},d=function(e){"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",function(){e()})},h=function(e){var n=document.createElement("script");n.text=e;var t=document.head;t.appendChild(n),t.removeChild(n)};function v(){return v=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},v.apply(this,arguments)}var m="function"==typeof fetch?fetch.bind():function(e,n){return n=n||{},new Promise(function(t,o){var r=new XMLHttpRequest;for(var i in r.open(n.method||"get",e,!0),n.headers)r.setRequestHeader(i,n.headers[i]);function a(){var e,n=[],t=[],o={};return r.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(r,i,a){n.push(i=i.toLowerCase()),t.push([i,a]),o[i]=(e=o[i])?e+","+a:a}),{ok:2==(r.status/100|0),status:r.status,statusText:r.statusText,url:r.responseURL,clone:a,text:function(){return Promise.resolve(r.responseText)},json:function(){return Promise.resolve(r.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([r.response]))},headers:{keys:function(){return n},entries:function(){return t},get:function(e){return o[e.toLowerCase()]},has:function(e){return e.toLowerCase()in o}}}}r.withCredentials="include"==n.credentials,r.onload=function(){t(a())},r.onerror=o,r.send(n.body||null)})};"function"!=typeof window.CustomEvent&&(window.CustomEvent=function(e,n){var t=n||{bubbles:!1,cancelable:!1,detail:void 0},o=document.createEvent("CustomEvent");return o.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),o},window.Event&&(CustomEvent.prototype=window.Event.prototype),window.CustomEvent=CustomEvent);var w=window.location.origin,p=(["https://a-tech.mos.ru","https://c-tech.mos.ru","https://t-tech.mos.ru","https://newmos.mos.ru","http://local.a-tech.mos.ru","http://local.c-tech.mos.ru","http://local.t-tech.mos.ru","http://c.local.mos-team.ru","http://a.local.mos-team.ru","http://t.local.mos-team.ru","http://local.mos-team.ru"].includes(w)?w:"https://www.mos.ru")+"/shared/schmetterling/v2/schmetterling.js";window.location.hostname.match(/\w+-tech.mos.ru/),"maxTouchPoints"in navigator||window.matchMedia&&matchMedia("(pointer:coarse)");var y=null,b=function(){if(y)return y;try{return y=m(p).then(function(e){return e.text()}).then(h).then(function(){return window.Schmetterling})}catch(e){return Promise.reject()}},g=new WeakMap,_={init:function(){window.mosTizer=_,d(_.renderAll),document.dispatchEvent(new CustomEvent("mosTizer.initialized"))},renderAll:function(e){var n;void 0===e&&(void 0===n&&(n=window.document),e=n.querySelectorAll("[data-mos-teaser]")),e.length&&[].forEach.call(e,function(e){return _.renderBanner(e)})},reloadAll:function(){b().then(function(e){e.reload()})},getBanner:function(e){return g.get(e)},renderBanner:function(e,n){var t=void 0===n?{}:n,o=t.onLoad,r=void 0===o?f:o,i=t.onError,a=void 0===i?f:i,c=t.onStub,u=void 0===c?f:c,s=t.onRender,l=void 0===s?f:s;return g.has(e)?g.get(e):(g.set(e,{reload:f}),b().then(function(n){var t=JSON.parse(e.dataset.mosTeaser).placementParams,o={ownerId:255877,params:{platform:t.p1},element:e,onError:a,onLoad:r,onStub:u,onRender:function(){e.dispatchEvent(new CustomEvent("bannerRendered")),l(e)}};n.create(o);var i=Promise.resolve(v({},o,{iframe:{},windowListeners:{},bannerId:"mosTizerBanner_"+t.p1,destroy:function(){n.destroy(e)}}));return g.set(e,i),i}).catch(f))},reloadBanner:function(e){_.getBanner(e)?b().then(function(n){return n.reload(e)}):_.renderBanner(e)},destroyBanner:function(e){_.getBanner(e)&&(b().then(function(n){return n.destroy(e)}),g.delete(e))}};function E(){return E=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},E.apply(this,arguments)}var T,C,j,L,k=["eventLoc","eventRef"],R={bannerLoad:"Load",bannerClick:"Click",bannerClose:"Close"},P=["eventType"],O=(C=!1,[function(e){C||(T=e,C=!0)},function(){return T}]),S=O[0],x=O[1],B=(j={},function(){var e;try{e=window.top.location.href}catch(n){e=window.location.href}return e===j.eventSrc||(j.bannerId=x(),j.mosId=document.cookie.replace(/(?:(?:^|.*;\s*)mos_id\s*=\s*([^;]*).*$)|^.*$/,"$1"),j.eventSrc=e),j}),I=null,A=function(){var e=arguments;return function(n){return[].slice.call(e).reduceRight(function(e,n){return n(e)},n)}}(function(e){var n=function(e){var n=e.eventLoc,t=e.eventRef,o=function(e,n){if(null==e)return{};var t,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n.indexOf(t=i[o])>=0||(r[t]=e[t]);return r}(e,k),r=window!==window.parent,i=r&&n||window.location.href,a=r&&t||window.document.referrer;return encodeURIComponent(JSON.stringify(E({eventDst:"stats",mosId:document.cookie.replace(/(?:(?:^|.*;\s*)mos_id\s*=\s*([^;]*).*$)|^.*$/,"$1")||null,eventTime:Math.round(Date.now()/1e3),eventLoc:i,eventRef:a},o)))}(e);(new Image).src="https://stats.mos.ru/eds.gif?o="+n},function(e){return(I||(I=new Promise(function(e){try{var n=new XMLHttpRequest;n.addEventListener("load",function(){h(this.responseText),window.yaCounter45066689=new window.Ya.Metrika({id:45066689,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0}),e(window.yaCounter45066689)}),n.open("GET","https://mc.yandex.ru/metrika/watch.js"),n.send()}catch(n){e(null)}}),I)).then(function(n){if(n){var t=e.eventType,o=function(e,n){if(null==e)return{};var t,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n.indexOf(t=i[o])>=0||(r[t]=e[t]);return r}(e,P);try{var r,i,a,c;n.reachGoal("AdFox",((c={})[R[t]]=((a={})[o.bannerId]=((i={})[o.mosId]=((r={})[o.eventSrc]=o.eventTime,r),i),a),c))}catch(e){}}}),e},function(e){return v({},B(),{eventType:e,eventTime:+new Date})}),z=function(){return A("bannerClick")},F=function(e){e.addEventListener("click",z)},M={pushEvent:A,click:z,init:function(){window.mosTizer=M,d(function(){window.mosTizer||d(function(){if(!/^(newmos\.||\w-tech\.||www\.)?mos\.ru/gi.test(location.host))for(var e=document.querySelectorAll("a"),n=0;n<e.length;n+=1)e[n].setAttribute("target","_blank")}),S(window.bannerId),A("bannerLoad"),[].forEach.call(window.document.querySelectorAll("a"),F)})}};window.mosTizer||(window.mosTizer={reloadBanner:f},((L=window)===L.top?"api":l)===l?M.init():_.init())}();
//# sourceMappingURL=mosTizer.js.map
